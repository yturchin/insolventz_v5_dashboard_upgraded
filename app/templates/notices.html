{% extends "base.html" %}

{% block content %}
  <div class="bg-white border rounded p-4">
    <div class="flex items-center justify-between gap-3">
      <div>
        <div class="font-semibold">Notices</div>
        <div class="text-xs text-slate-500 mt-1">
          Total: {{ counts.total }} · Generated: {{ counts.Generated }} · Accepted: {{ counts.Accepted }} · Sent: {{ counts.Sent }}
        </div>
      </div>

      <div class="flex items-center gap-2">
        <form method="get" action="/notices" class="flex items-center gap-2">
          <select name="status" class="border rounded px-2 py-1 text-sm">
            <option value="" {% if not filters.status %}selected{% endif %}>All statuses</option>
            <option value="Generated" {% if filters.status == 'Generated' %}selected{% endif %}>Generated</option>
            <option value="Accepted" {% if filters.status == 'Accepted' %}selected{% endif %}>Accepted</option>
            <option value="Sent" {% if filters.status == 'Sent' %}selected{% endif %}>Sent</option>
          </select>
          <button class="border rounded px-3 py-1 text-sm bg-slate-900 text-white" type="submit">Filter</button>
        </form>
      </div>
    </div>
  </div>

  <div class="bg-white border rounded p-4 mt-4">
    <div class="font-semibold">Generate notices from selected transactions</div>
    <div class="text-xs text-slate-500 mt-1">Paste transaction IDs (comma or space separated). Tip: pick from the Rules page.</div>
    <form method="post" action="/notices/generate_selected" class="mt-3 flex flex-col md:flex-row gap-2">
      <input class="border rounded px-2 py-2 flex-1" name="tx_ids" placeholder="e.g. 101, 102, 205" />
      <button class="border rounded px-3 py-2 bg-slate-900 text-white" type="submit">Generate notices</button>
    </form>
  </div>

  <div class="bg-white border rounded p-4 mt-4">
    <div class="font-semibold">List</div>
    <div class="overflow-x-auto mt-2">
      <table class="min-w-full text-sm">
        <thead class="text-left text-slate-500">
          <tr>
            <th class="py-2">Updated</th>
            <th class="py-2">Counterparty</th>
            <th class="py-2">Status</th>
            <th class="py-2">Transactions</th>
            <th class="py-2"></th>
            <th class="py-2"></th>
          </tr>
        </thead>
        <tbody>
          {% for n in notices %}
            <tr class="border-t">
              <td class="py-2">{{ n.updated_at }}</td>
              <td class="py-2">{{ n.counterparty_name }}</td>
              <td class="py-2">{{ n.status }}</td>
              <td class="py-2">{{ (n.transaction_ids|length) if n.transaction_ids else 0 }}</td>
              <td class="py-2"><a class="underline" href="/notices/{{ n.id }}">Open</a></td>
              <td class="py-2">
                <a class="underline" href="/files/download?path={{ n.file_path|urlencode }}">PDF</a>
              </td>
            </tr>
          {% endfor %}
          {% if notices|length == 0 %}
            <tr class="border-t"><td class="py-2 text-slate-500" colspan="6">No notices yet.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
